const { getStreamFromURL } = global.utils;

module.exports = {
  config: {
    name: "moment",
    aliases: ["mt"],
    version: "1.0",
    author: "Rakib",
    category: "love",
    guide: "{prefix}moment @mention ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶â‡¶ï‡ßá reply ‡¶¶‡¶ø‡¶®"
  },

  onStart: async function ({ event, message, usersData }) {
    try {
      const senderID = event.senderID;

      // -------------------------
      // TARGET SYSTEM (reply > mention)
      // -------------------------
      let targetID = null;

      if (event.type === "message_reply") {
        targetID = event.messageReply.senderID;
      } else if (event.mentions && Object.keys(event.mentions).length > 0) {
        targetID = Object.keys(event.mentions)[0];
      }

      if (!targetID) {
        return message.reply("‚ùå ‡¶ï‡¶æ‡¶â‡¶ï‡ßá reply ‡¶¨‡¶æ mention ‡¶ï‡¶∞‡¶≤‡ßá‡¶á moment ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá‡•§");
      }

      // -------------------------
      // NAMES
      // -------------------------
      const name1 = await usersData.getName(senderID).catch(() => "‡¶§‡ßÅ‡¶Æ‡¶ø");
      const name2 = await usersData.getName(targetID).catch(() => "‡¶∏‡ßá");

      // -------------------------
      // RANDOM MESSAGES
      // -------------------------
      const moments = [
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Æ‡¶æ‡¶∞‡¶§‡ßá ‡¶è‡¶∏‡ßá, ‡¶®‡¶ø‡¶ú‡ßá‡¶á ‡¶Æ‡¶æ‡¶∞ ‡¶ñ‡ßá‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡ßá‚Äî‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∞‡¶æ‡¶ó ‡¶®‡¶ø‡ßü‡ßá ‡¶è‡¶≤‡ßá, ‡¶Ü‡¶∞ ‡¶´‡¶ø‡¶∞‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶π‡¶æ‡¶∏‡¶ø ‡¶®‡¶ø‡ßü‡ßá‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ù‡¶ó‡ßú‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶≤‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶ú‡ßú‡¶ø‡ßü‡ßá ‡¶ß‡¶∞‡¶≤‡¶æ‡¶Æ‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ö‡¶ø‡ßé‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡¶æ‡¶õ‡ßá ‡¶è‡¶≤‡ßá, ‡¶Ü‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶è‡¶∏‡ßá ‡¶ö‡ßÅ‡¶™ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡ßá‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶∂‡¶æ‡¶∏‡¶æ‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ‡ßü ‡¶π‡¶æ‡¶∞‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶π‡¶æ‡¶§ ‡¶§‡ßÅ‡¶≤‡¶§‡ßá ‡¶è‡¶≤‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶π‡¶æ‡¶§‡¶ü‡¶æ ‡¶∂‡ßá‡¶∑‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶æ‡¶§‡ßá‡¶á ‡¶∞‡¶á‡¶≤‡ßã‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∞‡¶æ‡¶ó ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶ö‡ßã‡¶ñ‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ ‡¶ß‡¶∞‡¶æ ‡¶™‡ßú‡ßá ‡¶ó‡ßá‡¶≤‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Æ‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶≤‡¶ø‡¶ô‡ßç‡¶ó‡¶® ‡¶¶‡¶ø‡ßü‡ßá ‡¶•‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶¶‡ßÇ‡¶∞‡ßá ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶®‡¶ø‡¶ú‡ßá‡¶á ‡¶ï‡¶æ‡¶õ‡ßá ‡¶ö‡¶≤‡ßá ‡¶è‡¶≤‡ßá‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ø‡ßÅ‡¶¶‡ßç‡¶ß ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶Ü‡¶Æ‡¶ø ‡¶™‡ßç‡¶∞‡ßá‡¶Æ‡ßá ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡¶≤‡¶æ‡¶Æ‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ö‡¶≠‡¶ø‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶≤‡ßá, ‡¶Ü‡¶Æ‡¶ø ‡¶ö‡ßÅ‡¶™‡¶ö‡¶æ‡¶™ ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶Ü‡¶™‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶≤‡¶æ‡¶Æ‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∞‡¶æ‡¶ó‡ßá ‡¶≤‡¶æ‡¶≤ ‡¶π‡ßü‡ßá ‡¶è‡¶≤‡ßá, ‡¶Ü‡¶∞ ‡¶Ü‡¶Æ‡¶ø ‡¶π‡¶æ‡¶∏‡¶ø‡¶§‡ßá ‡¶∏‡¶¨ ‡¶ó‡¶≤‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶≤‡¶æ‡¶Æ‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ú‡¶ø‡¶§‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá ‡¶ù‡¶ó‡ßú‡¶æ‡ßü, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶π‡ßá‡¶∞‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶≠‡¶æ‡¶≤‡ßã‡¶¨‡¶æ‡¶∏‡¶æ‡ßü‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∂‡¶ï‡ßç‡¶§ ‡¶π‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶è‡¶∏‡ßá ‡¶®‡¶∞‡¶Æ ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡ßá‡•§",
        "‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶π‡¶æ‡¶∞‡¶æ‡¶§‡ßá ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá, ‡¶Ü‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶ï‡ßá ‡¶™‡ßá‡ßü‡ßá ‡¶ó‡ßá‡¶≤‡ßá‡•§"
      ];

      const randomLine = moments[Math.floor(Math.random() * moments.length)];

      // -------------------------
      // FINAL TEXT (names included)
      // -------------------------
      const finalText =
`üíû ${name1} √ó ${name2}

${randomLine}`;

      // -------------------------
      // GIF ATTACHMENT
      // -------------------------
      const gifStream = await getStreamFromURL(
        "https://i.postimg.cc/j5xDFykj/moment.gif"
      );

      return message.reply({
        body: finalText,
        attachment: gifStream
      });

    } catch (err) {
      console.error("moment command error:", err);
      return message.reply("‚ùå moment ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶ö‡¶æ‡¶≤‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
    }
  }
};
